<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Museum Exploration</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        #painting-info {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            max-width: 500px;
            text-align: center;
            display: none;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>Museum Exploration</h2>
        <p>WASD to move | Mouse to look around | Click on paintings to view details</p>
    </div>
    <div id="painting-info">
        <span class="close-btn" onclick="closePaintingInfo()">×</span>
        <h3 id="painting-title"></h3>
        <p id="painting-artist"></p>
        <p id="painting-description"></p>
    </div>
    <div id="controls">
        <p>Movement: WASD or Arrow Keys</p>
        <p>Look: Mouse Move</p>
        <p>Interact: Click</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/PointerLockControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/TextureLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xaaaaaa);
        
        // Camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 5);
        
        // Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(0, 10, 5);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 1024;
        directionalLight.shadow.mapSize.height = 1024;
        scene.add(directionalLight);
        
        // Controls
        let controls;
        let orbitControls;
        let pointerLockActive = true;
        
        function initControls() {
            if (pointerLockActive) {
                if (orbitControls) {
                    orbitControls.dispose();
                }
                controls = new THREE.PointerLockControls(camera, document.body);
                scene.add(controls.getObject());
                
                // Pointer lock event listeners
                document.addEventListener('click', () => {
                    if (!pointerLockActive) {
                        controls.lock();
                    }
                }, false);
                
                document.addEventListener('pointerlockchange', () => {
                    pointerLockActive = document.pointerLockElement === document.body;
                });
                
                controls.lock();
            } else {
                if (controls) {
                    scene.remove(controls.getObject());
                }
                orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
                orbitControls.target.set(0, 1.6, 0);
                orbitControls.update();
            }
        }
        
        initControls();
        
        // Toggle controls with 'C' key
        document.addEventListener('keydown', (event) => {
            if (event.key === 'c' || event.key === 'C') {
                pointerLockActive = !pointerLockActive;
                initControls();
            }
        });
        
        // Movement variables
        const moveSpeed = 0.1;
        const moveState = {
            forward: false,
            backward: false,
            left: false,
            right: false
        };
        
        // Event listeners for movement
        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'w':
                case 'W':
                case 'ArrowUp':
                    moveState.forward = true;
                    break;
                case 's':
                case 'S':
                case 'ArrowDown':
                    moveState.backward = true;
                    break;
                case 'a':
                case 'A':
                case 'ArrowLeft':
                    moveState.left = true;
                    break;
                case 'd':
                case 'D':
                case 'ArrowRight':
                    moveState.right = true;
                    break;
            }
        });
        
        document.addEventListener('keyup', (event) => {
            switch (event.key) {
                case 'w':
                case 'W':
                case 'ArrowUp':
                    moveState.forward = false;
                    break;
                case 's':
                case 'S':
                case 'ArrowDown':
                    moveState.backward = false;
                    break;
                case 'a':
                case 'A':
                case 'ArrowLeft':
                    moveState.left = false;
                    break;
                case 'd':
                case 'D':
                case 'ArrowRight':
                    moveState.right = false;
                    break;
            }
        });
        
        // Create museum floor plan
        function createMuseum() {
            const textureLoader = new THREE.TextureLoader();
            
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(50, 50);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0xcccccc,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Walls - creating a museum with multiple connected rooms
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0xf0f0f0,
                roughness: 0.7
            });
            
            // Main hall (central room)
            createRoom(0, 0, 15, 15, 3, wallMaterial);
            
            // North wing
            createRoom(0, 12, 15, 10, 3, wallMaterial);
            
            // South wing
            createRoom(0, -12, 15, 10, 3, wallMaterial);
            
            // East wing
            createRoom(12, 0, 10, 15, 3, wallMaterial);
            
            // West wing
            createRoom(-12, 0, 10, 15, 3, wallMaterial);
            
            // Add doorways between rooms
            createDoorway(0, 7.5, 5, 2.5, 3);
            createDoorway(0, -7.5, 5, 2.5, 3);
            createDoorway(7.5, 0, 2.5, 5, 3);
            createDoorway(-7.5, 0, 2.5, 5, 3);
            
            // Add paintings to the walls
            addPaintings();
            
            // Add some decorative elements
            addDecorations();
        }
        
        function createRoom(x, z, width, depth, height, material) {
            // Floor (different color for each room)
            const floorGeometry = new THREE.PlaneGeometry(width, depth);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: new THREE.Color(
                    0.8 + Math.random() * 0.2,
                    0.8 + Math.random() * 0.2,
                    0.8 + Math.random() * 0.2
                ),
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.set(x, 0, z);
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Walls
            const wallThickness = 0.2;
            
            // North wall
            const northWall = new THREE.Mesh(
                new THREE.BoxGeometry(width, height, wallThickness),
                material
            );
            northWall.position.set(x, height/2, z + depth/2);
            northWall.castShadow = true;
            northWall.receiveShadow = true;
            scene.add(northWall);
            
            // South wall
            const southWall = new THREE.Mesh(
                new THREE.BoxGeometry(width, height, wallThickness),
                material
            );
            southWall.position.set(x, height/2, z - depth/2);
            southWall.castShadow = true;
            southWall.receiveShadow = true;
            scene.add(southWall);
            
            // East wall
            const eastWall = new THREE.Mesh(
                new THREE.BoxGeometry(wallThickness, height, depth),
                material
            );
            eastWall.position.set(x + width/2, height/2, z);
            eastWall.castShadow = true;
            eastWall.receiveShadow = true;
            scene.add(eastWall);
            
            // West wall
            const westWall = new THREE.Mesh(
                new THREE.BoxGeometry(wallThickness, height, depth),
                material
            );
            westWall.position.set(x - width/2, height/2, z);
            westWall.castShadow = true;
            westWall.receiveShadow = true;
            scene.add(westWall);
            
            // Ceiling
            const ceiling = new THREE.Mesh(
                new THREE.PlaneGeometry(width, depth),
                new THREE.MeshStandardMaterial({ color: 0xeeeeee })
            );
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.set(x, height, z);
            ceiling.receiveShadow = true;
            scene.add(ceiling);
        }
        
        function createDoorway(x, z, width, height, wallHeight) {
            // This creates an opening in the wall by not placing geometry there
            // In a more advanced version, you'd create actual door frames
        }
        
        // Painting data
        const paintings = [
            {
                title: "Starry Night",
                artist: "Vincent van Gogh",
                description: "One of the most recognized paintings in Western art, depicting the view from Van Gogh's asylum room at Saint-Rémy-de-Provence.",
                year: "1889",
                size: "73.7 cm × 92.1 cm",
                position: { x: 7.4, y: 1.5, z: 0 },
                rotation: 0,
                size3d: { width: 1.5, height: 1.2 },
                room: "east"
            },
            {
                title: "Mona Lisa",
                artist: "Leonardo da Vinci",
                description: "Perhaps the most famous portrait ever painted, known for the subject's enigmatic expression.",
                year: "1503–1506",
                size: "77 cm × 53 cm",
                position: { x: 0, y: 1.5, z: 7.4 },
                rotation: Math.PI / 2,
                size3d: { width: 0.8, height: 1.2 },
                room: "north"
            },
            {
                title: "The Persistence of Memory",
                artist: "Salvador Dalí",
                description: "Famous for its surrealistic imagery of melting clocks in a landscape setting.",
                year: "1931",
                size: "24 cm × 33 cm",
                position: { x: -7.4, y: 1.5, z: 0 },
                rotation: Math.PI,
                size3d: { width: 0.5, height: 0.35 },
                room: "west"
            },
            {
                title: "The Scream",
                artist: "Edvard Munch",
                description: "An iconic representation of human anxiety, with a figure against a blood-red sky.",
                year: "1893",
                size: "91 cm × 73.5 cm",
                position: { x: 0, y: 1.5, z: -7.4 },
                rotation: -Math.PI / 2,
                size3d: { width: 1, height: 0.8 },
                room: "south"
            },
            {
                title: "Girl with a Pearl Earring",
                artist: "Johannes Vermeer",
                description: "Often referred to as the 'Mona Lisa of the North', this painting shows a girl with a pearl earring.",
                year: "1665",
                size: "44.5 cm × 39 cm",
                position: { x: 12, y: 1.5, z: 5 },
                rotation: Math.PI / 4,
                size3d: { width: 0.6, height: 0.5 },
                room: "northeast"
            }
        ];
        
        function addPaintings() {
            const textureLoader = new THREE.TextureLoader();
            
            paintings.forEach((painting, index) => {
                // Load painting texture
                textureLoader.load(`https://source.unsplash.com/random/800x600/?art,${index}`, (texture) => {
                    const paintingMaterial = new THREE.MeshStandardMaterial({
                        map: texture,
                        side: THREE.DoubleSide
                    });
                    
                    const paintingGeometry = new THREE.PlaneGeometry(
                        painting.size3d.width,
                        painting.size3d.height
                    );
                    
                    const paintingMesh = new THREE.Mesh(paintingGeometry, paintingMaterial);
                    paintingMesh.position.set(
                        painting.position.x,
                        painting.position.y,
                        painting.position.z
                    );
                    paintingMesh.rotation.y = painting.rotation;
                    
                    // Add frame
                    const frameGeometry = new THREE.BoxGeometry(
                        painting.size3d.width + 0.1,
                        painting.size3d.height + 0.1,
                        0.1
                    );
                    const frameMaterial = new THREE.MeshStandardMaterial({
                        color: 0x8B4513, // Wooden color
                        roughness: 0.3,
                        metalness: 0.3
                    });
                    const frame = new THREE.Mesh(frameGeometry, frameMaterial);
                    frame.position.copy(paintingMesh.position);
                    frame.rotation.y = painting.rotation;
                    frame.position.z += painting.rotation === 0 ? -0.06 : 
                                      (painting.rotation === Math.PI ? 0.06 : 
                                      (painting.rotation === Math.PI/2 ? -0.06 : 0.06));
                    
                    // Add to scene
                    scene.add(paintingMesh);
                    scene.add(frame);
                    
                    // Make it clickable
                    paintingMesh.userData = {
                        isPainting: true,
                        paintingData: painting
                    };
                    
                    // Add to raycaster objects
                    interactiveObjects.push(paintingMesh);
                });
            });
        }
        
        function addDecorations() {
            // Add some statues or decorative elements
            const statueGeometry = new THREE.ConeGeometry(0.3, 1, 8);
            const statueMaterial = new THREE.MeshStandardMaterial({ color: 0xcd7f32 }); // Bronze color
            
            // Statues in corners
            const statue1 = new THREE.Mesh(statueGeometry, statueMaterial);
            statue1.position.set(6, 0.5, 6);
            scene.add(statue1);
            
            const statue2 = new THREE.Mesh(statueGeometry, statueMaterial);
            statue2.position.set(-6, 0.5, 6);
            scene.add(statue2);
            
            const statue3 = new THREE.Mesh(statueGeometry, statueMaterial);
            statue3.position.set(6, 0.5, -6);
            scene.add(statue3);
            
            const statue4 = new THREE.Mesh(statueGeometry, statueMaterial);
            statue4.position.set(-6, 0.5, -6);
            scene.add(statue4);
            
            // Add some ceiling lights
            const lightGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const lightMaterial = new THREE.MeshBasicMaterial({ color: 0xffffcc });
            
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    const light = new THREE.Mesh(lightGeometry, lightMaterial);
                    light.position.set(i * 5, 2.8, j * 5);
                    scene.add(light);
                    
                    // Add point light
                    const pointLight = new THREE.PointLight(0xffffcc, 0.8, 5);
                    pointLight.position.set(i * 5, 2.5, j * 5);
                    scene.add(pointLight);
                }
            }
        }
        
        // Interactive objects
        const interactiveObjects = [];
        
        // Raycaster for interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        function onMouseMove(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }
        
        function onClick(event) {
            if (!pointerLockActive) return;
            
            // Update the mouse variable
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Update the raycaster
            raycaster.setFromCamera(mouse, camera);
            
            // Calculate objects intersecting the picking ray
            const intersects = raycaster.intersectObjects(interactiveObjects);
            
            if (intersects.length > 0) {
                const object = intersects[0].object;
                
                if (object.userData.isPainting) {
                    showPaintingInfo(object.userData.paintingData);
                }
            }
        }
        
        function showPaintingInfo(painting) {
            document.getElementById('painting-title').textContent = painting.title;
            document.getElementById('painting-artist').textContent = `${painting.artist} (${painting.year})`;
            document.getElementById('painting-description').textContent = painting.description;
            document.getElementById('painting-info').style.display = 'block';
        }
        
        function closePaintingInfo() {
            document.getElementById('painting-info').style.display = 'none';
        }
        
        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Movement
            if (pointerLockActive && controls) {
                if (moveState.forward) controls.moveForward(moveSpeed);
                if (moveState.backward) controls.moveForward(-moveSpeed);
                if (moveState.left) controls.moveRight(-moveSpeed);
                if (moveState.right) controls.moveRight(moveSpeed);
            } else if (orbitControls) {
                orbitControls.update();
            }
            
            renderer.render(scene, camera);
        }
        
        // Event listeners
        window.addEventListener('resize', onWindowResize, false);
        window.addEventListener('mousemove', onMouseMove, false);
        window.addEventListener('click', onClick, false);
        
        // Create the museum
        createMuseum();
        
        // Start animation
        animate();
    </script>
</body>
</html>